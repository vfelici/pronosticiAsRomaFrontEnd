<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pronostici AS Roma</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Pronostici AS Roma</h1>

<div id="login">
    <input id="username" placeholder="Username">
    <input id="password" placeholder="Password" type="password">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
</div>

<div id="main" style="display:none;">
    <h2>Inserisci pronostico</h2>
    <input id="match_id" placeholder="ID partita">
    <input id="home_score" placeholder="Gol Roma">
    <input id="away_score" placeholder="Gol avversari">
    <input id="scorer" placeholder="Marcatore">
    <button onclick="addPrediction()">Invia</button>

    <h2>Visualizza pronostici</h2>
    <input id="view_match_id" placeholder="ID partita">
    <button onclick="viewPredictions()">Mostra pronostici</button>
    <div id="predictions_list"></div>

    <h2>Classifica</h2>
    <div id="leaderboard"></div>
</div>

<!-- üîπ Links admin: saranno mostrati solo se l'utente loggato √® admin -->
<div id="adminLinks" style="display:none; margin-top:30px; text-align:center;">
    <h3>Pannelli Admin</h3>
    <p><a href="admin_inserisci.html" target="_blank">‚ûï Inserisci Partita</a></p>
    <p><a href="admin_risultati.html" target="_blank">‚úèÔ∏è Aggiorna Risultati</a></p>
</div>

<script src="app.js"></script>
<script>
let token = "";
let isAdmin = false;

async function login() {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();

  const res = await fetch("https://backendpronosticiasroma.onrender.com/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, password })
  });

  const data = await res.json();
  if (res.ok && data.token) {
    token = data.token;
    localStorage.setItem("token", token);

    // üîé decode del payload JWT per capire se admin
    const decoded = JSON.parse(atob(token.split(".")[1]));
    isAdmin = decoded.is_admin || false;

    document.getElementById("login").style.display = "none";
    document.getElementById("main").style.display = "block";

    if(isAdmin){
      document.getElementById("adminLinks").style.display = "block";
    }
    // carica eventuali leaderboard ecc...
    loadLeaderboard();
  } else {
    alert(data.error || "Errore login");
  }
}

function register() {
  // registrazione utente (gi√† ce l'hai in app.js)
}
</script>
</body>
</html>
