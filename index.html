<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pronostici AS Roma</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Pronostici AS Roma</h1>

<div id="login">
    <input id="username" placeholder="Username">
    <input id="password" placeholder="Password" type="password">
    <button onclick="login()">Login</button>
    <button onclick="register()">Register</button>
</div>

<div id="main" style="display:none;">
    <h2>Inserisci pronostico</h2>
    <input id="match_id" placeholder="ID partita">
    <input id="home_score" placeholder="Gol Roma">
    <input id="away_score" placeholder="Gol avversari">
    <input id="scorer" placeholder="Marcatore">
    <button onclick="addPrediction()">Invia</button>

    <h2>Visualizza pronostici</h2>
    <input id="view_match_id" placeholder="ID partita">
    <button onclick="viewPredictions()">Mostra pronostici</button>
    <div id="predictions_list"></div>

    <h2>Classifica</h2>
    <div id="leaderboard"></div>
</div>

<!-- üîπ Links admin: saranno visibili solo se l'utente √® admin -->
<div id="adminLinks" style="display:none; margin-top:30px; text-align:center;">
    <h3>Pannelli Admin</h3>
    <p><a href="add-match.html" target="_blank">‚ûï Inserisci Partita</a></p>
    <p><a href="admin_risultati.html" target="_blank">‚úèÔ∏è Aggiorna Risultati</a></p>
</div>

<script src="app.js"></script>
<script>
let token = "";
let isAdmin = false;

async function login() {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();

  try {
    const res = await fetch("https://backendpronosticiasroma.onrender.com/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password })
    });

    const data = await res.json();

    if (res.ok && data.token) {
      token = data.token;
      localStorage.setItem("token", token);

      // Decodifica JWT
      let decoded = {};
      try {
        decoded = JSON.parse(atob(token.split(".")[1]));
      } catch (e) {
        console.error("Errore decodifica JWT:", e);
      }

      console.log("Payload JWT:", decoded);
      isAdmin = username == "Valerio" || false; //decoded.is_admin || false;

      // Mostra pannelli user
      document.getElementById("login").style.display = "none";
      document.getElementById("main").style.display = "block";

      // Mostra link admin solo se admin E se l'elemento esiste
      const adminLinks = document.getElementById("adminLinks");
      if (isAdmin && adminLinks) {
        adminLinks.style.display = "block";
      }

      // Carica classifica (funzione nel tuo app.js)
      if (typeof loadLeaderboard === "function") {
        loadLeaderboard();
      }
    } else {
      alert(data.error || "Errore login");
    }
  } catch (err) {
    console.error("Errore di connessione al server:", err);
    alert("Errore di connessione al server. Controlla la console.");
  }
}

// esempio di funzione register (se non gi√† in app.js)
function register() {
  alert("Funzione register ancora da implementare üòÖ");
}
</script>
</body>
</html>
